import{S as te,i as se,s as le,l as S,u as q,a as j,x as re,m as A,p as I,v as B,c as R,h as k,y as ae,q as L,b as V,J as d,z as ne,w as G,f as oe,t as he,L as F,C as ce}from"../../chunks/index-1f84a181.js";import{g as z,b as J,O as K,R as Y,f as ie,T as fe}from"../../chunks/util-edf8d725.js";import ue from"./ProgressGraph.svelte-1de44e16.js";function U(a,s,e){const l=a.slice();return l[18]=s[e],l[20]=e,l}function W(a,s,e){const l=a.slice();return l[21]=s[e],l}function X(a,s,e){const l=a.slice();return l[24]=s[e],l}function Z(a){let s,e=a[24]+"";return{c(){s=S("th"),this.h()},l(l){s=A(l,"TH",{class:!0});var o=I(s);o.forEach(k),this.h()},h(){L(s,"class","headingRow svelte-1si6rt8")},m(l,o){V(l,s,o),s.innerHTML=e},p(l,o){o&256&&e!==(e=l[24]+"")&&(s.innerHTML=e)},d(l){l&&k(s)}}}function x(a){let s,e=a[9](a[18].sub[a[21]])+"",l;return{c(){s=S("span"),l=q(e),this.h()},l(o){s=A(o,"SPAN",{class:!0});var u=I(s);l=B(u,e),u.forEach(k),this.h()},h(){L(s,"class","weaker svelte-1si6rt8")},m(o,u){V(o,s,u),d(s,l)},p(o,u){u&5&&e!==(e=o[9](o[18].sub[o[21]])+"")&&G(l,e)},d(o){o&&k(s)}}}function $(a){let s,e=a[18].main[a[21]]+"",l,o,u=!isNaN(a[18].main[a[21]]),h=u&&x(a);return{c(){s=S("td"),l=q(e),o=j(),h&&h.c(),this.h()},l(p){s=A(p,"TD",{class:!0});var f=I(s);l=B(f,e),o=R(f),h&&h.l(f),f.forEach(k),this.h()},h(){L(s,"class","svelte-1si6rt8")},m(p,f){V(p,s,f),d(s,l),d(s,o),h&&h.m(s,null)},p(p,f){f&5&&e!==(e=p[18].main[p[21]]+"")&&G(l,e),f&5&&(u=!isNaN(p[18].main[p[21]])),u?h?h.p(p,f):(h=x(p),h.c(),h.m(s,null)):h&&(h.d(1),h=null)},d(p){p&&k(s),h&&h.d()}}}function ee(a){let s,e,l=a[3][a[20]]+"",o,u,h,p=K(a[0]),f=[];for(let m=0;m<p.length;m+=1)f[m]=$(W(a,p,m));return{c(){s=S("tr"),e=S("td"),o=q(l),u=j();for(let m=0;m<f.length;m+=1)f[m].c();h=j(),this.h()},l(m){s=A(m,"TR",{class:!0});var _=I(s);e=A(_,"TD",{class:!0});var g=I(e);o=B(g,l),g.forEach(k),u=R(_);for(let E=0;E<f.length;E+=1)f[E].l(_);h=R(_),_.forEach(k),this.h()},h(){L(e,"class","headingCell cdInfo svelte-1si6rt8"),L(s,"class","svelte-1si6rt8")},m(m,_){V(m,s,_),d(s,e),d(e,o),d(s,u);for(let g=0;g<f.length;g+=1)f[g].m(s,null);d(s,h)},p(m,_){if(_&8&&l!==(l=m[3][m[20]]+"")&&G(o,l),_&517){p=K(m[0]);let g;for(g=0;g<p.length;g+=1){const E=W(m,p,g);f[g]?f[g].p(E,_):(f[g]=$(E),f[g].c(),f[g].m(s,h))}for(;g<f.length;g+=1)f[g].d(1);f.length=p.length}},d(m){m&&k(s),F(f,m)}}}function me(a){let s,e,l,o,u,h,p,f,m,_,g,E,y,D,H,N,P,w=a[8],b=[];for(let t=0;t<w.length;t+=1)b[t]=Z(X(a,w,t));let M=a[2],n=[];for(let t=0;t<M.length;t+=1)n[t]=ee(U(a,M,t));return N=new ue({props:{title:a[5],progressData:a[4],maxlength:a[1]}}),{c(){s=S("div"),e=S("table"),l=S("caption"),o=q(a[6]),u=j(),h=S("span"),p=q(a[7]),f=j(),m=S("thead"),_=S("th"),g=j();for(let t=0;t<b.length;t+=1)b[t].c();E=j(),y=S("tbody");for(let t=0;t<n.length;t+=1)n[t].c();D=j(),H=S("div"),re(N.$$.fragment),this.h()},l(t){s=A(t,"DIV",{class:!0});var r=I(s);e=A(r,"TABLE",{class:!0});var c=I(e);l=A(c,"CAPTION",{});var i=I(l);o=B(i,a[6]),u=R(i),h=A(i,"SPAN",{class:!0});var C=I(h);p=B(C,a[7]),C.forEach(k),i.forEach(k),f=R(c),m=A(c,"THEAD",{});var T=I(m);_=A(T,"TH",{class:!0}),I(_).forEach(k),g=R(T);for(let O=0;O<b.length;O+=1)b[O].l(T);T.forEach(k),E=R(c),y=A(c,"TBODY",{class:!0});var v=I(y);for(let O=0;O<n.length;O+=1)n[O].l(v);v.forEach(k),c.forEach(k),D=R(r),H=A(r,"DIV",{class:!0});var Q=I(H);ae(N.$$.fragment,Q),Q.forEach(k),r.forEach(k),this.h()},h(){L(h,"class","weaker svelte-1si6rt8"),L(_,"class","svelte-1si6rt8"),L(y,"class","svelte-1si6rt8"),L(e,"class","table-bordered svelte-1si6rt8"),L(H,"class","graphContainer svelte-1si6rt8"),L(s,"class","container svelte-1si6rt8")},m(t,r){V(t,s,r),d(s,e),d(e,l),d(l,o),d(l,u),d(l,h),d(h,p),d(e,f),d(e,m),d(m,_),d(m,g);for(let c=0;c<b.length;c+=1)b[c].m(m,null);d(e,E),d(e,y);for(let c=0;c<n.length;c+=1)n[c].m(y,null);d(s,D),d(s,H),ne(N,H,null),P=!0},p(t,[r]){if((!P||r&64)&&G(o,t[6]),(!P||r&128)&&G(p,t[7]),r&256){w=t[8];let i;for(i=0;i<w.length;i+=1){const C=X(t,w,i);b[i]?b[i].p(C,r):(b[i]=Z(C),b[i].c(),b[i].m(m,null))}for(;i<b.length;i+=1)b[i].d(1);b.length=w.length}if(r&525){M=t[2];let i;for(i=0;i<M.length;i+=1){const C=U(t,M,i);n[i]?n[i].p(C,r):(n[i]=ee(C),n[i].c(),n[i].m(y,null))}for(;i<n.length;i+=1)n[i].d(1);n.length=M.length}const c={};r&32&&(c.title=t[5]),r&16&&(c.progressData=t[4]),r&2&&(c.maxlength=t[1]),N.$set(c)},i(t){P||(oe(N.$$.fragment,t),P=!0)},o(t){he(N.$$.fragment,t),P=!1},d(t){t&&k(s),F(b,t),F(n,t),ce(N)}}}function pe(a,s){let e=a.main.length;for(let l=e;l<s;l++)a.main.push("-"),a.sub.push("-")}function ge(a,s,e){let{mode:l}=s,{members:o}=s,{includings:u}=s,{extra:h={}}=s;function p(n,t){let r={cd:t.cd,member:n,main:[],sub:Array(t.lastDraw).fill(0)},c=ie(t.table,["member",n]);if(c){c.slotsSold.map(T=>T.split("|")).flat().map(T=>T.match(/^\d+$/)?r.sub[parseInt(T)-1]++:0);let C=0;r.main=r.sub.map(T=>C+=T)}return r}function f(n,t=-1){let r=[],c=[],i=-1;for(let C=0;C<u.length;C++){let T;t<=u[C].lastDraw?(T=fe(u[C].table.find(v=>v.member==n),t),T[1]=="N/A"?(r.push(["-","-"]),c.push("-")):(r.push(T),c.push(i>-1?c[i]+T[0]:T[0]),i=C)):(r.push(["-","-"]),c.push("-"))}return{member:n,main:c,sub:r}}function m(n){if(l.slice(0,3)=="fix")return`(+${n})`;if(l=="overallProgression")return`(+${n[0]}/${n[1]})`;if(l=="receptionProgression")return`/${n}`}let _=0,g={},E="",y=0,D=[],H,N,P=[],w=[],b=[];const M=(n,t)=>n.p0.skip||n.p1.skip?t:void 0;return a.$$set=n=>{"mode"in n&&e(10,l=n.mode),"members"in n&&e(11,o=n.members),"includings"in n&&e(12,u=n.includings),"extra"in n&&e(13,h=n.extra)},a.$$.update=()=>{if(a.$$.dirty&31759){if(e(3,P=[]),e(2,D=[]),e(14,w=[]),l.slice(0,3)=="fix"){l=="fixCD"&&(o.map(r=>{D.push(p(r,u[0])),P.push(z(r).kanji)}),e(5,E=`\u5BFE\u8C61\u5186\u76E4\uFF1A ${J(D[0].cd).display}`),e(0,_=u[0].lastDraw)),l=="fixMember"&&(u.map(r=>{D.push(p(o[0],r)),P.push(J(r.cd).display)}),e(5,E=`\u5BFE\u8C61\u30E1\u30F3\u30D0\u30FC\uFF1A ${z(D[0].member).kanji}`),e(0,_=Math.max(...u.map(r=>r.lastDraw)))),D.map(r=>pe(r,_)),e(6,H="\u7D2F\u8A08\u5B8C\u58F2\u6570\u306E\u63A8\u79FB"),e(7,N="(N\u6B21\u53D7\u4ED8\u306E\u5B8C\u58F2\u6570)");let t=D.map(r=>r.main.length);e(1,y=Math.max(...t)),e(14,w=K(1,y+1)),e(8,b=w)}if(l=="overallProgression"&&(e(0,_=u.length),e(2,D=o.map(t=>f(t))),e(3,P=o.map(t=>z(t).kanji)),e(5,E="\u7DCF\u5B8C\u58F2\u6570\u63A8\u79FB"),e(6,H="\u7D2F\u8A08\u7DCF\u5B8C\u58F2\u6570"),e(7,N="(\u5186\u76E4\u306E\u7DCF\u5B8C\u58F2\u90E8\u6570 / \u6700\u5927\u53EF\u80FD\u5B8C\u58F2\u6570)"),e(14,w=u.map(t=>J(t.cd).display)),e(8,b=w.map(t=>t.replace(/\s/,"<br>")))),l=="receptionProgression"){e(0,_=u.length),"atdraw"in h||console.log("Something wrong.  Need to specify 'atdraw' for this option.");let t=o.map(r=>f(r,h.atdraw));console.log(t),e(2,D=t.map(r=>({member:r.member,main:r.sub.map(c=>c[0]),sub:r.sub.map(c=>c[1])}))),console.log(D),e(3,P=o.map(r=>z(r).kanji)),e(5,E=`${h.atdraw}\u6B21\u53D7\u4ED8\u307E\u3067\u306E\u5B8C\u58F2\u6570\u63A8\u79FB`),e(6,H=`${h.atdraw}\u6B21\u53D7\u4ED8\u307E\u3067\u306E\u5B8C\u58F2\u6570`),e(7,N=" / \u5186\u76E4\u306E\u6700\u5927\u53EF\u80FD\u5B8C\u58F2\u6570"),e(14,w=u.map(r=>J(r.cd).display)),e(8,b=w.map(r=>r.replace(/\s/,"<br>")))}e(2,D),e(10,l),e(11,o),e(12,u),e(3,P),e(0,_),e(1,y),e(14,w),e(13,h);let n={labels:w,datasets:[]};for(let t=0;t<D.length;t++){let r={label:P[t],data:D[t].main,borderColor:`${Y(t)}`,backgroundColor:`${Y(t)}`,pointHitRadius:20,segment:{borderColor:c=>M(c,"rgb(0,0,0,0.5)"),borderDash:c=>M(c,[6,6])},spanGaps:!0,datalabels:{color:"white",backgroundColor:`${Y(t)}`}};n.datasets.push(r)}e(4,g=n)}},[_,y,D,P,g,E,H,N,b,m,l,o,u,h,w]}class De extends te{constructor(s){super(),se(this,s,ge,me,le,{mode:10,members:11,includings:12,extra:13})}}export{De as default};
